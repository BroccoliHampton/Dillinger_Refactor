<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dillinger Outlaw Space Commando 1995</title>
    
    <!-- Farcaster Frame Meta -->
    <meta name="fc:frame" content="vNext">
    <meta name="fc:frame:image" content="https://dillinger-game.vercel.app/preview.png">
    <meta name="fc:frame:button:1" content="Play Game">
    <meta name="fc:frame:post_url" content="https://dillinger-game.vercel.app">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="/css/main.css">
    
    <!-- Main Script (ES Module) -->
    <script type="module" src="/js/main.js"></script>
</head>
<body class="overflow-x-hidden">
    <!-- Background Starfield -->
    <div id="starfield"></div>

    <!-- ========================================= -->
    <!-- MINT OVERLAY (Start Screen) -->
    <!-- ========================================= -->
    <div id="mint-overlay" class="fixed inset-0 z-50 flex flex-col items-center justify-start bg-black/95 p-4 overflow-y-auto">
        <div class="text-center max-w-md w-full py-6">
            <h1 class="font-title text-2xl md:text-3xl text-yellow-400 mb-2 tracking-wider" style="text-shadow: 0 0 10px #facc15;">
                DILLINGER
            </h1>
            <p class="font-title text-xs text-green-400 mb-4">OUTLAW SPACE COMMANDO 1995</p>
            
            <div class="wireframe-container" style="max-width: 150px; margin: 0 auto 1rem;">
                <svg id="wireframe-ship-0" class="wireframe-ship-part" viewBox="0 0 100 100">
                    <polygon points="50,10 20,90 50,70 80,90"/>
                    <line x1="50" y1="10" x2="50" y2="70"/>
                    <line x1="20" y1="90" x2="80" y2="90"/>
                </svg>
                <svg id="wireframe-ship-45" class="wireframe-ship-part" viewBox="0 0 100 100">
                    <polygon points="50,10 20,90 50,70 80,90"/>
                    <line x1="50" y1="10" x2="50" y2="70"/>
                    <line x1="20" y1="90" x2="80" y2="90"/>
                </svg>
                <svg id="wireframe-ship-90" class="wireframe-ship-part" viewBox="0 0 100 100">
                    <polygon points="50,10 20,90 50,70 80,90"/>
                    <line x1="50" y1="10" x2="50" y2="70"/>
                    <line x1="20" y1="90" x2="80" y2="90"/>
                </svg>
                <svg id="wireframe-ship-135" class="wireframe-ship-part" viewBox="0 0 100 100">
                    <polygon points="50,10 20,90 50,70 80,90"/>
                    <line x1="50" y1="10" x2="50" y2="70"/>
                    <line x1="20" y1="90" x2="80" y2="90"/>
                </svg>
            </div>

            <!-- Mission Briefing -->
            <div class="text-left space-y-3 mb-6 px-2">
                <div class="p-3 bg-black/50 rounded border-l-2 border-yellow-500">
                    <h3 class="text-yellow-400 font-bold text-xs mb-1">OBJECTIVE</h3>
                    <p class="text-xs text-gray-300">Travel 1,000,000 lightyears to escape the law before time runs out. Collect outstanding warrants to prove your infamy.</p>
                </div>

                <div class="p-3 bg-black/50 rounded border-l-2 border-cyan-500">
                    <h3 class="text-cyan-400 font-bold text-xs mb-1">SOLAR SAILS</h3>
                    <p class="text-xs text-gray-300">Craft sails (cost: photons) to generate lightyears. Power scales with sun intensity at time of crafting. Sails degrade and must be jettisoned when broken.</p>
                </div>

                <div class="p-3 bg-black/50 rounded border-l-2 border-yellow-500">
                    <h3 class="text-yellow-400 font-bold text-xs mb-1">PHOTON BATTERIES</h3>
                    <p class="text-xs text-gray-300">Craft batteries (cost: lightyears) to generate passive photon income. Power scales with substrate conductivity at time of crafting.</p>
                </div>

                <div class="p-3 bg-black/50 rounded border-l-2 border-red-500">
                    <h3 class="text-red-400 font-bold text-xs mb-1">ENCOUNTERS</h3>
                    <p class="text-xs text-gray-300">Random events trigger during crafting. Risk it for rewards or play it safe.</p>
                </div>

                <div class="p-3 bg-black/50 rounded border-l-2 border-purple-500">
                    <h3 class="text-purple-400 font-bold text-xs mb-1">BLACK HOLE</h3>
                    <p class="text-xs text-gray-300">High-risk minigame. Costs 250K LY and all sails. Navigate the warp tunnel for massive distance.</p>
                </div>
            </div>
            
            <button id="mint-button" class="retro-button font-title text-sm py-3 px-8 rounded text-green-400 hover:text-white">
                [ LAUNCH MISSION ]
            </button>
        </div>
    </div>

    <!-- ========================================= -->
    <!-- LOADING SPINNER -->
    <!-- ========================================= -->
    <div id="loading-spinner" class="fixed inset-0 z-40 flex flex-col items-center justify-center bg-black/80 hidden">
        <div class="spinner"></div>
        <p class="mt-4 font-title text-xs text-green-400">INITIALIZING SYSTEMS...</p>
    </div>

    <!-- ========================================= -->
    <!-- GAME HEADER -->
    <!-- ========================================= -->
    <header id="game-header" class="w-full max-w-lg mx-auto p-2 flex justify-between items-center hidden">
        <p id="user-id-display" class="text-xs text-gray-500 hidden">FID: ---</p>
        <button id="mute-button" class="audio-control-button">
            <i id="mute-icon" class="fas fa-volume-up"></i>
        </button>
    </header>

    <!-- ========================================= -->
    <!-- MAIN GAME CONTAINER -->
    <!-- ========================================= -->
    <main id="game-container" class="w-full max-w-lg mx-auto p-2 hidden">
        <div id="game-area">

            <!-- ===== VITALS TAB ===== -->
            <section id="vitals-tab-content" class="tab-content active">
                <div class="retro-border secondary-panel-bg rounded-lg p-3 mb-3">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="font-title text-xs text-green-400">// SYSTEM VITALS</h2>
                        <span id="system-mode-display" class="text-xs font-bold" style="color: var(--neon-green);">STANDARD</span>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <!-- Photons -->
                        <div class="stat-grid-item photons-gauge rounded p-2">
                            <p class="text-yellow-400 font-bold">PHOTONS</p>
                            <p id="photons-display" class="text-xl text-white font-bold">0</p>
                            <p id="photon-rate-display" class="text-yellow-300 text-xs">+0/s</p>
                            <div id="photons-activity-gauge" class="activity-gauge"></div>
                        </div>
                        <!-- Sun Intensity -->
                        <div class="stat-grid-item btc-glow rounded p-2">
                            <p class="text-orange-400 font-bold">SUN INTENSITY</p>
                            <p id="btc-price-display" class="text-xl text-white font-bold">500,000</p>
                            <p class="text-orange-300 text-xs">lux</p>
                            <div id="sun-activity-gauge" class="activity-gauge"></div>
                        </div>
                        <!-- Substrate -->
                        <div class="stat-grid-item substrate-glow rounded p-2">
                            <p class="text-pink-400 font-bold text-xs">SUBSTRATE CONDUCTIVITY</p>
                            <p id="eth-price-display" class="text-xl text-white font-bold">4,000</p>
                            <p class="text-pink-300 text-xs">S/m</p>
                            <div id="substrate-activity-gauge" class="activity-gauge electric-gauge"></div>
                        </div>
                        <!-- Lightyears -->
                        <div class="stat-grid-item lightyears-glow rounded p-2">
                            <p class="text-cyan-400 font-bold">LIGHTYEARS</p>
                            <p id="lightyears-display" class="text-xl text-white font-bold">0</p>
                            <p id="lightyear-rate-display" class="text-cyan-300 text-xs">~0/s</p>
                            <div id="lightyears-activity-gauge" class="activity-gauge"></div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="mt-3">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-gray-400">PROGRESS TO FREEDOM</span>
                            <span class="text-pink-400">1,000,000 LY</span>
                        </div>
                        <div class="progress-bar rounded-full overflow-hidden">
                            <div id="progress-fill" class="progress-fill h-full rounded-full" style="width: 0%;"></div>
                        </div>
                    </div>

                    <!-- Warrants -->
                    <div class="mt-3 text-center">
                        <p id="warrants-display" class="text-red-500 font-bold text-sm">
                            <i class="fas fa-skull-crossbones mr-2"></i> 0
                        </p>
                        <p class="text-gray-500 text-xs">OUTSTANDING WARRANTS</p>
                    </div>
                </div>
            </section>

            <!-- ===== MAP TAB ===== -->
            <section id="map-tab-content" class="tab-content">
                <div class="retro-border secondary-panel-bg rounded-lg p-3">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="font-title text-xs text-green-400">// NAVIGATION</h2>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-400">SYSTEM:</span>
                            <span id="system-name-display" class="text-xs text-yellow-400 font-bold">Orion's Anvil</span>
                        </div>
                    </div>

                    <!-- Map Timer -->
                    <div class="text-center mb-2 p-2 bg-black/30 rounded border border-red-500/50">
                        <p class="text-xs text-red-400">TIME TO INTERCEPT</p>
                        <p id="map-timer-display" class="text-2xl font-bold text-red-500 font-title">05:00</p>
                    </div>

                    <!-- Navigation Map -->
                    <div id="navigation-map" class="relative w-full aspect-square bg-black/50 rounded overflow-hidden border border-green-500/30" style="border-color: var(--neon-yellow);">
                        <canvas id="map-overlay-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none z-20 opacity-75"></canvas>
                        <svg id="main-map-svg" width="100%" height="100%" viewBox="0 0 400 400" class="absolute inset-0 z-10 opacity-80" style="background-color: transparent;">
                            <defs>
                                <filter id="neon-glow" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blur" /><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                                <filter id="pixelate" x="0" y="0" width="100%" height="100%"><feFlood x="2" y="2" height="4" width="4" flood-color="#00ff41" result="color" /><feComposite in="SourceGraphic" in2="color" operator="in" /><feComponentTransfer><feFuncA type="discrete" tableValues="0 1"/></feComponentTransfer><feGaussianBlur stdDeviation="0.8" result="blur" /><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 20 -10" result="sharpen"/></filter>
                                <filter id="pixelate_planet" x="0" y="0" width="100%" height="100%"><feGaussianBlur stdDeviation="0.5" result="blur"/><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 10 -5" result="sharpen"/><feComponentTransfer><feFuncA type="discrete" tableValues="0 1"/></feComponentTransfer></filter>
                                <g id="dillinger-ship" filter="url(#neon-glow)"><circle cx="0" cy="0" r="4" fill="#00ff41" /></g>
                                <g id="retro-stars" fill="white"><circle cx="50" cy="50" r="1" /> <circle cx="200" cy="150" r="2" /> <circle cx="350" cy="300" r="1" /> <circle cx="100" cy="380" r="2" /> <circle cx="300" cy="50" r="1" /> <circle cx="10" cy="300" r="1" /> <circle cx="380" cy="10" r="2" /></g>
                                <g id="armada-icon" fill="#d1d5db" stroke="#6b7280" stroke-width="1"><rect x="0" y="10" width="25" height="5" filter="url(#pixelate)" /> <polygon points="10,0 20,0 25,10" filter="url(#pixelate)" /> <rect x="30" y="15" width="15" height="3" filter="url(#pixelate)" /> <rect x="15" y="25" width="20" height="4" filter="url(#pixelate)" /></g>
                                <g id="jupiter-sprite"><circle cx="30" cy="30" r="28" fill="#a0522d" filter="url(#pixelate_planet)" /> <rect x="2" y="5" width="56" height="6" rx="2" fill="#d2b48c" filter="url(#pixelate_planet)" /> <rect x="0" y="15" width="60" height="6" fill="#8b4513" filter="url(#pixelate_planet)" /> <rect x="0" y="25" width="60" height="10" fill="#d2b48c" filter="url(#pixelate_planet)" /> <rect x="0" y="37" width="60" height="6" fill="#8b4513" filter="url(#pixelate_planet)" /> <rect x="2" y="48" width="56" height="6" rx="2" fill="#d2b48c" filter="url(#pixelate_planet)" /> <ellipse cx="40" cy="30" rx="6" ry="4" fill="#800000" filter="url(#pixelate_planet)" /> <circle cx="41" cy="30" r="1.5" fill="#f08080" filter="url(#pixelate_planet)" /> <circle cx="45" cy="15" r="5" fill="white" opacity="0.1" filter="url(#pixelate_planet)" /></g>
                                <g id="nebula-sprite"><rect x="0" y="0" width="40" height="40" fill="#1a1a2e" filter="url(#pixelate_planet)" opacity="0.1"/> <circle cx="20" cy="20" r="15" fill="#00ffff" opacity="0.4" filter="url(#pixelate_planet)" /> <path d="M 25 5 C 35 5, 40 15, 30 25 L 10 30 L 5 15 Z" fill="#ff00ff" opacity="0.3" filter="url(#pixelate_planet)" /> <path d="M 5 35 L 20 40 L 40 30 L 30 20 Z" fill="#0000ff" opacity="0.35" filter="url(#pixelate_planet)" /> <rect x="18" y="18" width="4" height="4" fill="white" filter="url(#pixelate_planet)" /></g>
                                <g id="red-planet-sprite"><circle cx="20" cy="20" r="18" fill="#c34a2c" filter="url(#pixelate_planet)" /> <rect x="5" y="15" width="30" height="5" fill="#e97451" filter="url(#pixelate_planet)" /> <circle cx="15" cy="25" r="3" fill="#8b3a20" filter="url(#pixelate_planet)" /> <circle cx="28" cy="10" r="2" fill="#e97451" opacity="0.8" filter="url(#pixelate_planet)" /></g>
                                <g id="icy-dwarf-sprite"><circle cx="15" cy="15" r="13" fill="#607d8b" filter="url(#pixelate_planet)" /> <path d="M 15 2 C 18 8, 12 10, 15 28 A 13 13 0 0 0 15 2" fill="#b0bec5" opacity="0.9" filter="url(#pixelate_planet)" /> <rect x="5" y="20" width="10" height="5" fill="#37474f" filter="url(#pixelate_planet)" /></g>
                                <g id="toxic-gas-sprite"><circle cx="25" cy="25" r="22" fill="#008080" filter="url(#pixelate_planet)" /> <path d="M 25 3 C 35 5, 40 15, 30 25 L 10 30 L 5 15 Z" fill="#00ffff" opacity="0.4" filter="url(#pixelate_planet)" /> <circle cx="35" cy="15" r="5" fill="#00ff00" opacity="0.6" filter="url(#pixelate_planet)" /> <rect x="5" y="30" width="40" height="4" fill="#006666" filter="url(#pixelate_planet)" /></g>
                                <g id="black-hole-sprite"><circle cx="20" cy="20" r="18" fill="#000000" /> <circle cx="20" cy="20" r="10" fill="#1a1a2e" stroke="#330033" stroke-width="2" /> <circle cx="20" cy="20" r="15" fill="none" stroke="#ff00ff" stroke-width="2" opacity="0.5" /> <circle cx="20" cy="20" r="20" fill="none" stroke="#00ffff" stroke-width="2" opacity="0.3" /></g>
                                <g id="ufo-sprite"><ellipse cx="25" cy="15" rx="20" ry="8" fill="#a0a0a0" filter="url(#pixelate)" /> <ellipse cx="25" cy="15" rx="15" ry="5" fill="#d0d0d0" filter="url(#pixelate)" /> <path d="M 15 5 L 35 5 L 40 15 L 10 15 Z" fill="#60a5fa" filter="url(#pixelate)" /> <circle cx="15" cy="15" r="2" fill="#00ff00" /> <circle cx="35" cy="15" r="2" fill="#00ff00" /></g>
                                <g id="space-swirl-sprite"><path d="M 5 20 C 10 10, 30 10, 35 20 C 30 30, 10 30, 5 20 Z" fill="#ff00ff" opacity="0.2" filter="url(#pixelate_planet)" /> <path d="M 10 15 C 20 5, 30 25, 10 35 Z" fill="#00ffff" opacity="0.3" filter="url(#pixelate_planet)" /> <circle cx="20" cy="20" r="5" fill="white" opacity="0.5" filter="url(#pixelate_planet)" /></g>
                                <g id="pulsar-sprite"><circle cx="20" cy="20" r="15" fill="#4f46e5" filter="url(#pixelate_planet)"/><path d="M 20 5 L 20 35 M 5 20 L 35 20" stroke="white" stroke-width="2" opacity="0.8"/></g>
                                <g id="crystal-planet-sprite"><polygon points="20,2 38,15 30,38 10,38 2,15" fill="#a78bfa" filter="url(#pixelate_planet)"/><polygon points="20,2 10,38 30,38" fill="#8b5cf6" filter="url(#pixelate_planet)"/></g>
                                <g id="volcanic-planet-sprite"><circle cx="25" cy="25" r="22" fill="#ef4444" filter="url(#pixelate_planet)"/><path d="M 10 25 C 15 15, 35 15, 40 25" stroke="#facc15" stroke-width="3" fill="none"/><circle cx="25" cy="18" r="4" fill="#f97316" filter="url(#pixelate_planet)"/></g>
                                <g id="ringed-planet-sprite"><circle cx="25" cy="25" r="18" fill="#3b82f6" filter="url(#pixelate_planet)"/><ellipse cx="25" cy="25" rx="28" ry="8" stroke="#93c5fd" stroke-width="3" fill="none" transform="rotate(-20 25 25)"/></g>
                                <g id="ghost-station-sprite"><rect x="10" y="10" width="30" height="30" fill="none" stroke="#00ffff" stroke-width="1" opacity="0.5"/><circle cx="25" cy="25" r="5" fill="#00ffff" opacity="0.7"/></g>
                                <g id="binary-star-sprite"><circle cx="15" cy="25" r="10" fill="#ffff00"/><circle cx="35" cy="15" r="8" fill="#ff8c00"/></g>
                                <g id="forge-planet-sprite"><circle cx="25" cy="25" r="22" fill="#ff4500"/><circle cx="25" cy="25" r="15" fill="#ff8c00"/><circle cx="25" cy="25" r="8" fill="#ffff00"/></g>
                                <g id="scrap-field-icon" fill="#a9a9a9"><rect x="0" y="5" width="10" height="2"/><rect x="5" y="0" width="2" height="12"/><rect x="-2" y="10" width="15" height="3"/></g>
                                <g id="living-planet-sprite"><circle cx="25" cy="25" r="23" fill="#006400"/><path d="M 10 10 C 20 30, 30 15, 40 40" stroke="#90ee90" stroke-width="2" fill="none"/></g>
                                <g id="bio-ship-icon"><path d="M 10 10 Q 25 0, 40 10 T 10 10" fill="#2e8b57"/><path d="M 15 10 L 25 25 L 35 10" fill="none" stroke="#3cb371" stroke-width="2"/></g>
                            </defs>
                            <use href="#retro-stars" />
                            <g id="ship-trail-group"></g>

                            <g id="map-display-1" style="display: block;"><line x1="50" y1="350" x2="350" y2="50" stroke="#00ff41" stroke-width="4" style="filter: url(#pixelate);" /><line x1="150" y1="250" x2="100" y2="150" stroke="#00882e" stroke-width="3" style="filter: url(#pixelate);" /><line x1="280" y1="180" x2="330" y2="280" stroke="#00882e" stroke-width="3" style="filter: url(#pixelate);" /><circle cx="50" cy="350" r="20" fill="#2563eb" filter="url(#pixelate_planet)" /><path d="M 50 330 C 55 340, 45 350, 50 370 A 20 20 0 0 0 50 330" fill="#60a5fa" opacity="0.8" filter="url(#pixelate_planet)" /><circle cx="350" cy="50" r="30" fill="#94a3b8" stroke="#00ff41" stroke-width="3" filter="url(#pixelate_planet)" /><path d="M 350 20 C 370 30, 350 50, 350 80 A 30 30 0 0 0 350 20" fill="#e2e8f0" opacity="0.7" filter="url(#pixelate_planet)" /><g transform="translate(175, 195) scale(0.6)"><use href="#red-planet-sprite" /></g><g transform="translate(120, 220) scale(0.9)"><use href="#jupiter-sprite" /></g><g transform="translate(230, 275) scale(0.6)"><use href="#toxic-gas-sprite" /></g><g transform="translate(315, 265) scale(0.8)"><use href="#icy-dwarf-sprite" /></g><g transform="translate(260, 160)"><use href="#armada-icon" transform="scale(2)" /></g><g transform="translate(30, 270) scale(0.8)"><use href="#ufo-sprite" /></g><g transform="translate(290, 120) scale(1.2)"><use href="#space-swirl-sprite" /></g><g transform="translate(80, 130) scale(1.5)"><use href="#nebula-sprite" /></g><g transform="translate(-5, 130) scale(1.3)"><use href="#black-hole-sprite" /></g></g>
                            <g id="map-display-2" style="display: none;"><line x1="50" y1="350" x2="350" y2="50" stroke="#f43f5e" stroke-width="4" style="filter: url(#pixelate);" /><line x1="200" y1="300" x2="100" y2="200" stroke="#8c2f4a" stroke-width="3" style="filter: url(#pixelate);" /><line x1="250" y1="150" x2="350" y2="250" stroke="#8c2f4a" stroke-width="3" style="filter: url(#pixelate);" /><g transform="translate(30, 330) scale(1.2)"><use href="#crystal-planet-sprite" /></g><g transform="translate(320, 20) scale(1.5)"><use href="#pulsar-sprite" /></g><g transform="translate(80, 180) scale(1.1)"><use href="#icy-dwarf-sprite"/></g><g transform="translate(180, 280) scale(0.8)"><use href="#red-planet-sprite"/></g><g transform="translate(230, 130) scale(1.4)"><use href="#black-hole-sprite"/></g><g transform="translate(330, 230) scale(1)"><use href="#toxic-gas-sprite"/></g></g>
                            <g id="map-display-3" style="display: none;"><line x1="50" y1="350" x2="350" y2="50" stroke="#f97316" stroke-width="4" style="filter: url(#pixelate);" /><line x1="50" y1="200" x2="200" y2="350" stroke="#8a400d" stroke-width="3" style="filter: url(#pixelate);" /><line x1="350" y1="200" x2="200" y2="50" stroke="#8a400d" stroke-width="3" style="filter: url(#pixelate);" /><g transform="translate(25, 325) scale(1.3)"><use href="#volcanic-planet-sprite" /></g><g transform="translate(320, 20) scale(1.4)"><use href="#ringed-planet-sprite" /></g><g transform="translate(180, 320) scale(1.1)"><use href="#jupiter-sprite" /></g><g transform="translate(30, 180) scale(0.9)"><use href="#nebula-sprite" /></g><g transform="translate(180, 30) scale(1.5)"><use href="#ufo-sprite" /></g><g transform="translate(330, 180) scale(1.2)"><use href="#space-swirl-sprite" /></g></g>
                            <g id="map-display-4" style="display: none;"><line x1="50" y1="350" x2="350" y2="50" stroke="#00ffff" stroke-width="4" style="filter: url(#pixelate);" /><g transform="translate(30, 330) scale(1.2)"><use href="#binary-star-sprite" /></g><g transform="translate(320, 20) scale(1.5)"><use href="#ghost-station-sprite" /></g><g transform="translate(150, 150) scale(1.8)"><use href="#black-hole-sprite"/></g><g transform="translate(250, 250) scale(1.2)"><use href="#nebula-sprite"/></g></g>
                            <g id="map-display-5" style="display: none;"><line x1="50" y1="350" x2="350" y2="50" stroke="#ffff00" stroke-width="4" style="filter: url(#pixelate);" /><g transform="translate(25, 325) scale(1.3)"><use href="#forge-planet-sprite" /></g><g transform="translate(320, 20) scale(1.4)"><use href="#armada-icon" /></g><g transform="translate(100, 100) scale(2)"><use href="#scrap-field-icon" /></g><g transform="translate(280, 280) scale(1.5)"><use href="#red-planet-sprite" /></g></g>
                            <g id="map-display-6" style="display: none;"><line x1="50" y1="350" x2="350" y2="50" stroke="#90ee90" stroke-width="4" style="filter: url(#pixelate);" /><g transform="translate(30, 330) scale(1.2)"><use href="#living-planet-sprite" /></g><g transform="translate(320, 20) scale(1.5)"><use href="#bio-ship-icon" /></g><g transform="translate(200, 200) scale(2)"><use href="#space-swirl-sprite" /></g><g transform="translate(100, 250) scale(1.2)"><use href="#toxic-gas-sprite" /></g></g>

                            <g id="dillinger-ship-group" class="pixelated"><use href="#dillinger-ship" /></g>
                        </svg>
                    </div>

                    <!-- Map Aux Dashboard -->
                    <div class="map-aux-dashboard">
                        <div class="target-info-panel">
                            <h3>TARGET</h3>
                            <p>ID: <span id="target-id">UN-77-B</span></p>
                            <p>CLASS: <span id="target-class">Nebula Fragment</span></p>
                            <p>DIST: <span id="target-dist">1.2 AU</span></p>
                            <p>SIGNAL: <span id="target-signal">Weak EM</span></p>
                        </div>
                        <div class="radar-container">
                            <canvas id="radar-canvas"></canvas>
                        </div>
                        <div class="system-status-panel">
                            <h3>STATUS</h3>
                            <p>SHIELDS: <span class="text-green-400">ONLINE</span></p>
                            <p>WEAPONS: <span class="text-yellow-400">STANDBY</span></p>
                            <p>ENGINES: <span class="text-green-400">NOMINAL</span></p>
                            <p>LIFE SUP: <span class="text-green-400">98%</span></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ===== ENGINES TAB ===== -->
            <section id="engines-tab-content" class="tab-content">
                <div class="retro-border secondary-panel-bg rounded-lg p-3 mb-3">
                    <h2 class="font-title text-xs text-green-400 mb-2">// PROPULSION BAY</h2>

                    <!-- Ship Visualization -->
                    <div class="relative w-full h-32 bg-black/50 rounded overflow-hidden mb-3 border border-cyan-500/30">
                        <canvas id="airstream-canvas" class="absolute top-0 left-0 w-full h-full"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg viewBox="0 0 100 60" class="w-24 h-16 sail-power-active">
                                <polygon points="50,5 10,55 50,45 90,55" fill="none" stroke="#00ffff" stroke-width="2"/>
                                <line x1="50" y1="5" x2="50" y2="45" stroke="#00ffff" stroke-width="1"/>
                            </svg>
                        </div>
                    </div>

                    <!-- Power Stats -->
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <div class="text-center p-2 bg-black/30 rounded border border-cyan-500/30">
                            <p class="text-xs text-gray-400">TOTAL POWER</p>
                            <p id="total-power-display" class="text-2xl font-bold text-cyan-400">0</p>
                        </div>
                        <div class="text-center p-2 bg-black/30 rounded border border-green-500/30">
                            <p class="text-xs text-gray-400">COOLDOWN</p>
                            <p id="cooldown-timer" class="text-2xl font-bold text-green-400">READY</p>
                        </div>
                    </div>

                    <!-- Balances -->
                    <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                        <div class="p-2 bg-black/30 rounded border border-yellow-500/30">
                            <span class="text-yellow-400">PHOTONS:</span>
                            <span id="photon-balance-engines" class="text-white font-bold ml-1">0</span>
                        </div>
                        <div class="p-2 bg-black/30 rounded border border-cyan-500/30">
                            <span class="text-cyan-400">LIGHTYEARS:</span>
                            <span id="lightyear-balance-engines" class="text-white font-bold ml-1">0</span>
                        </div>
                    </div>

                    <!-- Craft Buttons -->
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <button id="craft-sail-button" class="retro-button p-3 rounded text-center">
                            <i class="fas fa-solar-panel text-2xl text-cyan-400 mb-1"></i>
                            <p class="text-xs text-white font-bold">CRAFT SAIL</p>
                            <p class="text-xs text-yellow-400">250 Photons</p>
                        </button>
                        <button id="craft-battery-button" class="retro-button p-3 rounded text-center">
                            <i class="fas fa-battery-full text-2xl text-yellow-400 mb-1"></i>
                            <p class="text-xs text-white font-bold">CRAFT BATTERY</p>
                            <p class="text-xs text-cyan-400">5,000 LY</p>
                        </button>
                    </div>

                    <!-- Slot Ratios -->
                    <div class="mb-3">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-cyan-400">SAILS</span>
                            <span class="text-yellow-400">BATTERIES</span>
                        </div>
                        <div class="h-2 bg-black/50 rounded-full overflow-hidden flex">
                            <div id="sail-ratio-bar" class="bg-cyan-400 h-full transition-all" style="width: 0%;"></div>
                            <div id="battery-ratio-bar" class="bg-yellow-400 h-full transition-all" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Slots -->
                <div class="retro-border secondary-panel-bg rounded-lg p-3">
                    <h2 class="font-title text-xs text-green-400 mb-2">// RADIATION CHAMBER</h2>
                    <div class="fuse-box-panel">
                        <div id="inventory-slots" class="grid grid-cols-4 gap-3">
                            <!-- Slots rendered by JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- ===== ACTION TAB ===== -->
            <section id="action-tab-content" class="tab-content">
                <div class="retro-border secondary-panel-bg rounded-lg p-3 mb-3">
                    <h2 class="font-title text-xs text-green-400 mb-2">// TACTICAL OPTIONS</h2>

                    <!-- Encounter Debrief -->
                    <div id="encounter-debrief-panel" class="hidden mb-3 p-3 bg-black/50 rounded border border-yellow-500/50">
                        <p class="text-xs text-yellow-400 font-bold mb-1">DEBRIEF:</p>
                        <p id="encounter-debrief-text" class="text-xs text-gray-300"></p>
                    </div>

                    <!-- Blackhole Entry -->
                    <div id="minigame-prompt" class="p-3 bg-black/50 rounded border border-purple-500/50 mb-3">
                        <h3 class="text-sm text-purple-400 font-bold mb-2">
                            <i class="fas fa-atom mr-2"></i>BLACK HOLE JUMP
                        </h3>
                        <p class="text-xs text-gray-400 mb-3">
                            Risk everything for a massive lightyear boost. Costs 250,000 LY and destroys all sails. Navigate the warp tunnel to escape!
                        </p>
                        <button id="enter-blackhole-button" class="retro-button w-full p-2 rounded text-purple-400 border-purple-500">
                            ENTER BLACK HOLE
                        </button>
                    </div>

                    <!-- Warp Minigame Container -->
                    <div id="minigame-container" class="hidden">
                        <div class="warp-game-container warp-game-font">
                            <div id="warp-gameView" class="flex-grow relative">
                                <div id="warp-viewContainer" class="w-full h-full">
                                    <canvas id="warp-gameCanvas"></canvas>
                                </div>
                            </div>
                            <div class="p-3 bg-black/80 border-t-2 border-orange-500">
                                <input type="range" id="warp-slider" class="warp-slider w-full mb-3" min="-100" max="100" value="0">
                                <button id="warp-out-button" class="warp-control-button w-full py-3 text-xl bg-green-900 border-2 border-green-500 text-green-400 rounded">
                                    WARP OUT & CLAIM
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Buttons (Dev) -->
                <div class="retro-border secondary-panel-bg rounded-lg p-3 mb-3">
                    <h2 class="font-title text-xs text-gray-500 mb-2">// DEV TOOLS</h2>
                    <div class="grid grid-cols-3 gap-2">
                        <button id="test-photons-button" class="retro-button p-2 rounded text-xs text-yellow-400 border-yellow-500/50">
                            +1K PHOTONS
                        </button>
                        <button id="test-lightyears-button" class="retro-button p-2 rounded text-xs text-cyan-400 border-cyan-500/50">
                            +250K LY
                        </button>
                        <button id="test-encounter-button" class="retro-button p-2 rounded text-xs text-red-400 border-red-500/50">
                            ENCOUNTER
                        </button>
                    </div>
                </div>

                <!-- Log Display -->
                <div class="retro-border secondary-panel-bg rounded-lg p-3">
                    <h2 class="font-title text-xs text-green-400 mb-2">// COMM LOG</h2>
                    <div id="log-display" class="log-container text-xs font-mono p-2 rounded bg-black/50">
                        <p class="text-gray-400">[BOOT] Systems online...</p>
                    </div>
                </div>
            </section>

            <!-- ===== BRIEFING TAB ===== -->
            <section id="briefing-tab-content" class="tab-content">
                <div class="retro-border secondary-panel-bg rounded-lg p-3 mb-3">
                    <h2 class="font-title text-xs text-green-400 mb-3">// MISSION BRIEFING</h2>

                    <div class="space-y-4 text-xs text-gray-300">
                        <div class="p-3 bg-black/30 rounded border-l-2 border-yellow-500">
                            <h3 class="text-yellow-400 font-bold mb-1">OBJECTIVE</h3>
                            <p>Travel 1,000,000 lightyears to escape the law. Collect outstanding warrants to prove your infamy.</p>
                        </div>

                        <div class="p-3 bg-black/30 rounded border-l-2 border-cyan-500">
                            <h3 class="text-cyan-400 font-bold mb-1">SOLAR SAILS</h3>
                            <p>Craft sails (cost: photons) to generate lightyears. Power scales with sun intensity at time of crafting. Sails degrade and must be jettisoned when broken.</p>
                        </div>

                        <div class="p-3 bg-black/30 rounded border-l-2 border-yellow-500">
                            <h3 class="text-yellow-400 font-bold mb-1">PHOTON BATTERIES</h3>
                            <p>Craft batteries (cost: lightyears) to generate passive photon income. Power scales with substrate conductivity at time of crafting.</p>
                        </div>

                        <div class="p-3 bg-black/30 rounded border-l-2 border-red-500">
                            <h3 class="text-red-400 font-bold mb-1">ENCOUNTERS</h3>
                            <p>Random events trigger during crafting. Risk it for rewards or play it safe. Each has different odds and payouts.</p>
                        </div>

                        <div class="p-3 bg-black/30 rounded border-l-2 border-purple-500">
                            <h3 class="text-purple-400 font-bold mb-1">BLACK HOLE</h3>
                            <p>High-risk minigame. Costs 250K LY and all sails. Navigate the warp tunnel to claim massive distance. Failure ends the run.</p>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="retro-border secondary-panel-bg rounded-lg p-3">
                    <h2 class="font-title text-xs text-green-400 mb-3">// SETTINGS</h2>

                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs text-gray-400">SYSTEM MODE</span>
                        <button id="cycle-mode-button" class="retro-button px-3 py-1 rounded text-xs">
                            CYCLE MODE
                        </button>
                    </div>

                    <div class="flex justify-center gap-4 mb-3">
                        <button id="mute-music-button" class="audio-control-button">
                            <i id="mute-music-icon" class="fas fa-volume-up"></i>
                        </button>
                        <button id="mute-sfx-button" class="audio-control-button">
                            <i id="mute-sfx-icon" class="fas fa-volume-up"></i>
                        </button>
                    </div>

                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs text-gray-400">SCANNER</span>
                        <button id="toggle-scanner-btn" class="retro-button px-3 py-1 rounded text-xs">
                            TOGGLE
                        </button>
                    </div>

                    <!-- Data Scanner -->
                    <div class="data-scanner">
                        <div class="scanner-bar"></div>
                        <div class="text-stream">SYSTEM SCAN: OK :: STARDIVE CORES: NOMINAL</div>
                    </div>

                    <!-- Reset -->
                    <div class="mt-4 pt-4 border-t border-red-500/30">
                        <button id="reset-prompt-button" class="retro-button w-full p-2 rounded text-red-400 border-red-500/50">
                            <i class="fas fa-skull mr-2"></i>ABORT MISSION
                        </button>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- ========================================= -->
    <!-- BOTTOM NAVIGATION -->
    <!-- ========================================= -->
    <nav id="bottom-nav-bar" class="bottom-nav hidden">
        <button id="nav-vitals" class="nav-button active">
            <i class="fas fa-heartbeat"></i>
            <span>Vitals</span>
        </button>
        <button id="nav-map" class="nav-button">
            <i class="fas fa-map-marked-alt"></i>
            <span>Map</span>
        </button>
        <button id="nav-engines" class="nav-button">
            <i class="fas fa-cogs"></i>
            <span>Engines</span>
        </button>
        <button id="nav-action" class="nav-button">
            <i class="fas fa-crosshairs"></i>
            <span>Action</span>
        </button>
        <button id="nav-briefing" class="nav-button">
            <i class="fas fa-file-alt"></i>
            <span>Brief</span>
        </button>
    </nav>

    <!-- ========================================= -->
    <!-- MODALS -->
    <!-- ========================================= -->

    <!-- Encounter Modal -->
    <div id="encounter-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 hidden">
        <div class="retro-border secondary-panel-bg rounded-lg p-4 max-w-sm w-full">
            <h2 class="font-title text-sm text-red-400 mb-3 text-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>ENCOUNTER
            </h2>
            <p id="encounter-description" class="text-sm text-gray-300 mb-4 text-center"></p>
            <div class="grid grid-cols-2 gap-3">
                <button id="encounter-avoid" class="retro-button p-2 rounded text-gray-400">
                    AVOID
                </button>
                <button id="encounter-risk-it" class="retro-button p-2 rounded text-yellow-400 border-yellow-500">
                    RISK IT
                </button>
            </div>
        </div>
    </div>

    <!-- Encounter Result Modal -->
    <div id="encounter-result-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 hidden">
        <div id="encounter-result-container" class="retro-border secondary-panel-bg rounded-lg p-4 max-w-sm w-full">
            <h2 id="encounter-result-title" class="font-title text-sm mb-3 text-center">
                <i id="encounter-result-icon" class="fas mr-2"></i><span id="encounter-result-label">RESULT</span>
            </h2>
            <p id="encounter-result-text" class="text-sm text-gray-300 mb-3 text-center"></p>
            <p id="encounter-result-net" class="text-xs text-center mb-4"></p>
            <button id="encounter-result-close" class="retro-button w-full p-2 rounded text-green-400 border-green-500">
                CONTINUE
            </button>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="win-message" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 hidden">
        <div class="retro-border secondary-panel-bg rounded-lg p-6 max-w-sm w-full text-center">
            <h2 class="font-title text-xl text-green-400 mb-3">FREEDOM!</h2>
            <p class="text-gray-300 mb-4">You've escaped the law... for now. Claim your warrant and continue the run!</p>
            <button id="claim-warrant-button" class="retro-button w-full p-3 rounded text-yellow-400 border-yellow-500 mb-2">
                <i class="fas fa-trophy mr-2"></i>CLAIM WARRANT
            </button>
            <button id="win-reset-button" class="retro-button w-full p-2 rounded text-gray-400">
                NEW GAME
            </button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-message" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 hidden">
        <div class="retro-border secondary-panel-bg rounded-lg p-6 max-w-sm w-full text-center" style="border-color: var(--neon-red);">
            <h2 class="font-title text-xl text-red-400 mb-3">CAPTURED</h2>
            <p class="text-gray-300 mb-4">The authorities have caught up. Your run ends here.</p>
            <button id="game-over-reset-button" class="retro-button w-full p-3 rounded text-red-400 border-red-500">
                <i class="fas fa-redo mr-2"></i>TRY AGAIN
            </button>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div id="reset-confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 hidden">
        <div class="retro-border secondary-panel-bg rounded-lg p-4 max-w-sm w-full">
            <h2 class="font-title text-sm text-red-400 mb-3 text-center">ABORT MISSION?</h2>
            <p class="text-sm text-gray-300 mb-4 text-center">All progress will be lost. Are you sure?</p>
            <div class="grid grid-cols-2 gap-3">
                <button id="reset-cancel-button" class="retro-button p-2 rounded text-gray-400">
                    CANCEL
                </button>
                <button id="reset-confirm-button" class="retro-button p-2 rounded text-red-400 border-red-500">
                    CONFIRM
                </button>
            </div>
        </div>
    </div>

</body>
</html>
